<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Simple WS Chat</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #messages {
            width: 100%;
            height: 200px;
        }

        #input {
            width: 80%;
        }
    </style>
</head>

<body>
    <h1>WebSocket Chat</h1>

    <!-- Text area to show chat history -->
    <textarea id="messages" readonly></textarea><br>

    <!-- Input + button to send messages -->
    <input id="input" placeholder="Type a message">
    <button id="send">Send</button>

    <script>
        const ws = new WebSocket("ws://localhost:4000"); // adjust if needed
        const messages = document.getElementById("messages");
        const input = document.getElementById("input");
        const sendBtn = document.getElementById("send");

        function addMessage(text) {

            text = JSON.parse(text)
            console.log(text);

            var textToShow = "";

            var date = new Date().toLocaleDateString();

            textToShow += date + " ";

            var time = new Date().toLocaleTimeString();

            textToShow += time + " ";

            if (text.from) {
                var from = text.from
                textToShow += from + ": ";
                textToShow += text.text;
            } else {
                textToShow += (text.text);
            }
            messages.value += textToShow + "\n";
            messages.scrollTop = messages.scrollHeight; // auto-scroll
        }

        function addUpdate(text) {
            messages.value += `                      ${text}\n`.toUpperCase();
            messages.scrollTop = messages.scrollHeight; // auto-scroll
        }

        ws.onopen = () => addUpdate("[connected]");
        ws.onmessage = (e) => addMessage(e.data);
        ws.onclose = () => addUpdate("[disconnected]");

        sendBtn.onclick = () => {
            if (input.value.trim()) {
                ws.send(input.value.trim());
                input.value = "";
            }
        };

        // allow Enter key to send too
        input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") sendBtn.click();
        });
    </script>
</body>

</html>